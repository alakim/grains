<html>
<head>
<script type="text/javascript" src="../fuzzy.js"></script>
<script type="text/javascript" src="html.js"></script>
<script type="text/javascript">
function extend(m,s){for(var k in s){m[k] = s[k];}}

function each(coll, F){
	if(coll.length)
		for(var i=0; i<coll.length; i++){F(coll[i], i);}
	else
		for(var k in coll){F(coll[k], k);}
}

function max(coll){
	var idx = 0;
	var val = null;
	each(coll, function(v, i){
		if(val==null){
			val = v; idx = i;
		}
		else if(v>val){
			val = v; idx = i;
		}
	});
	
	return {val:val, idx:idx};
}

function filter(coll, cond){
	var res = [];
	NsiBase.each(coll, function(el){if(cond(el))res.push(el);});
	return res;
}

function $(id){
	return document.getElementById(id);
}

function $$(tag, root, condition){
	root = root?root:document;
	var coll = root.getElementsByTagName(tag);
	if(condition!=null){
		if(typeof(condition)=="string")
			condition = new Function("el", "with(el){return "+condition+";}");
		coll = NsiBase.filter(coll, condition);
	}
	return coll;
}

function isIE(){
	return navigator.appName.match(/internet\s+explorer/i);
}

function addEventHandler(element, event, handler){
	if(element.addEventListener)
		element.addEventListener(event, handler, true);
	else
		element.attachEvent("on"+event, handler);
}

function viewObject(obj, htmlMode){
	if(typeof(obj)!="object")
		return obj.toString();
	var s = [];
	for(var k in obj){
		if(typeof(obj[k])!="function")
			s.push((htmlMode?k.bold():k)+": "+NsiBase.viewObject(obj[k], htmlMode)+(htmlMode?"<br>":"\n"));
	}
	return s.join("");
}


var MakeUp = {
	
	rules: {
		wide: Fuzzy.functions.S(600, 800),
		narrow: Fuzzy.functions.Z(200, 350),
		lowHeight: Fuzzy.functions.Z(100, 200),
		
		useNarrow: function(w, h){with(Fuzzy){var _=this;
			return and(_.narrow(w), not(_.lowHeight(h))) > 0.5;
		}},
		
		useNoNews: function(w, h){with(Fuzzy){var _=this;
			return and(not(_.wide(w)), not(_.lowHeight(h))) > 0.5;
		}},
		
		useStandard: function(w,h){with(Fuzzy){var _=this;
			return and(_.wide(w), not(_.lowHeight(h))) > 0.5;
		}},
		
		useLight: function(w,h){with(Fuzzy){var _=this;
			return and(_.narrow(w), _.lowHeight(h)) > 0.5;
		}}
	},
	
	blocks:{
		header: function(){with(Html){
			return div(
				h1("Заголовок сайта")
			);
		}},
		
		news: function(){with(Html){
			return div(
				h2("Новости"),
				times(10, function(i){
					return p(i, ": ", "Текст новостного сообщения");
				})
			);
		}},
		
		page: function(){with(Html){
			return div(
				times(22, function(i){
					return p(i, ": ",
						times(200, function(i){return "abcdefg ";})
					);
				})
			);
		}},
		
		menu: function(){with(Html){
			return div(
				h2("Разделы сайта"),
				ul(
					times(6, function(i){
						return li("Раздел ", i);
					})
				)
			)
		}}
	},
	
	makeUps:{
		narrow: function(){with(Html){var _=MakeUp;
			return div(
				_.blocks.header(),
				p(a({href:"#"}, "Новости")),
				_.blocks.menu(),
				_.blocks.page()
			);
		}},
		
		standard: function(){with(Html){
			return table({border:1, width:"100%", cellpadding:3, cellspacing:0}, 
				tr(td({colspan:3, align:"center"}, MakeUp.blocks.header())),
				tr(
					td({valign:"top", width:150}, MakeUp.blocks.menu()),
					td({valign:"top"}, MakeUp.blocks.page()),
					td({valign:"top", width:150}, MakeUp.blocks.news())
				)
			);
		}},
		
		noNews: function(){with(Html){
			return table({border:1, width:"100%", cellpadding:3, cellspacing:0}, 
				tr(td({colspan:2, align:"center"}, MakeUp.blocks.header())),
				tr(
					td({valign:"top", width:150},
						p(a({href:"#"}, "Новости")),
						MakeUp.blocks.menu()
					),
					td({valign:"top"}, MakeUp.blocks.page())
				)
			);
		}},
		
		light: function(){with(Html){var _=MakeUp;
			return div(
				_.blocks.header(),
				p(a({href:"#"}, "Оглавление")),
				p(a({href:"#"}, "Новости")),
				_.blocks.page()
			);
		}}
	},
	
	arrange: function(width, height){var _=this;
		var width = window.innerWidth;
		var height = window.innerHeight;
		
		var rates = [
			_.rules.useNarrow(width, height),
			_.rules.useNoNews(width, height),
			_.rules.useLight(width, height),
			_.rules.useStandard(width, height)
		];
		
		switch(max(rates).idx){
			case 0: document.body.innerHTML = _.makeUps.narrow();break;
			case 1: document.body.innerHTML = _.makeUps.noNews();break;
			case 2: document.body.innerHTML = _.makeUps.light();break;
			case 3: document.body.innerHTML = _.makeUps.standard();break;
			default: document.body.innerHTML = _.makeUps.standard();break;
		}
	}
}

function init(){
	addEventHandler(window, "resize", function(){ MakeUp.arrange(); });
	MakeUp.arrange();
}
</script>
</head>
<body onload="init()">
</body>
</html>