<html>
<head>
<title>Html Unit Tests</title>
<script type="text/javascript" src="../tools/jsUnit.js"></script>
<script type="text/javascript" src="html.js"></script>
<script type="text/javascript">
new JSUnit.Test("Подключение модуля Html", "Configuration").run = function(){
	this.assert(typeof(Html), "object");
}

new JSUnit.Test("Простая верстка", "Верстка").run = function(){
	with(Html){
		this.assert(
			div(
				p("abc"),
				p("def")
			),
			"<div><p>abc</p><p>def</p></div>"
		);
	}
}

new JSUnit.Test("Простая верстка с атрибутами", "Верстка").run = function(){
	with(Html){
		this.assert(
			div({
					"class":"panel",
					width:200
				},
				p("abc")
			),
			"<div class=\"panel\" width=\"200\"><p>abc</p></div>"
		);
	}
}

new JSUnit.Test("Простая таблица", "Верстка").run = function(){
	with(Html){
		this.assert(
			table({border:0, cellpadding:0, cellspacing:0},
				tr(td("11"), td("12")),
				tr(td("21"), td("22"))
			),
			"<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td>11</td><td>12</td></tr><tr><td>21</td><td>22</td></tr></table>"
		);
	}
}

new JSUnit.Test("Таблица с пустыми ячейками", "Верстка").run = function(){
	with(Html){
		this.assert(
			table(
				tr(th("ss"), th("  ")),
				tr(td("11"), td("   ")),
				tr(td(), td("22"))
			),
			"<table><tr><th>ss</th><th>&nbsp;</th></tr><tr><td>11</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>22</td></tr></table>"
		)
	}
}

new JSUnit.Test("Картинки", "Верстка").run = function(){
	with(Html){
		this.assert(
			div(
				hr(),
				img({src:"null.gif", width:"10px"}),
				br(),
				p("abc")
			),
			"<div><hr/><img src=\"null.gif\" width=\"10px\"/><br/><p>abc</p></div>"
		);
	}
}

new JSUnit.Test("Таблица", "Шаблоны").run = function(){
	with(Html){
		var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
		this.assert(
			table(
				apply(data, function(el){
					return tr(td(el.nm), td(el.nr))
				})
			),
			"<table><tr><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr></table>"
		);
	}
}

new JSUnit.Test("Таблица с раскрашенными строками", "Шаблоны").run = function(){
	with(Html){
		var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}, {nm:"ghi", nr:3}];
		this.assert(
			table(
				apply(data, function(el, i){
					return tr(i%2?null:{"class":"even"},
						td(el.nm), td(el.nr)
					)
				})
			),
			"<table><tr class=\"even\"><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr><tr class=\"even\"><td>ghi</td><td>3</td></tr></table>"
		);
	}
}

new JSUnit.Test("Таблица с заголовком", "Шаблоны").run = function(){
	with(Html){
		var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
		this.assert(
			table({border:0, cellpadding:3, cellspacing:0},
				tr(th("Name"), th("Number")),
				apply(data, function(el){
					return tr(td(el.nm), td(el.nr))
				})
			),
			"<table border=\"0\" cellpadding=\"3\" cellspacing=\"0\"><tr><th>Name</th><th>Number</th></tr><tr><td>abc</td><td>1</td></tr><tr><td>def</td><td>2</td></tr></table>"
		);
	}
}
new JSUnit.Test("Таблица с источником данных в структуре", "Шаблоны").run = function(){
	with(Html){
		var data = {
			"John":22,
			"Phill":33,
			"George":44
		};
		this.assert(
			table(
				apply(data, function(val, nm){
					return tr(
						td(nm),
						td(val)
					);
				})
			),
			"<table><tr><td>John</td><td>22</td></tr><tr><td>Phill</td><td>33</td></tr><tr><td>George</td><td>44</td></tr></table>"
		);
	}
}

new JSUnit.Test("Нумерация", "Шаблоны").run = function(){
	with(Html){
		var data = [{nm:"abc", nr:1}, {nm:"def", nr:2}];
		this.assert(
			div(
				apply(data, function(el, i){
					return p((i+1)+". "+el.nm);
				})
			),
			"<div><p>1. abc</p><p>2. def</p></div>"
		)
	}
}

new JSUnit.Test("Итерация 1", "Шаблоны").run = function(){
	with(Html){
		this.assert(
			div(
				times(2, function(i){
					return span(i);
				})
			),
			"<div><span>1</span><span>2</span></div>"
		);
	}
}

new JSUnit.Test("Итерация 2", "Шаблоны").run = function(){
	with(Html){
		this.assert(
			div(
				p("xyz"),
				times(2, function(i){
					return span(i);
				}),
				p("abc")
			),
			"<div><p>xyz</p><span>1</span><span>2</span><p>abc</p></div>"
		);
	}
}

function init(){
	document.getElementById("versionPanel").innerHTML = Html.version;
	JSUnit.init();
}
</script>
</head>
<body onload="init()">
	<h1>Html Unit Tests</h1>
	<p>Html v.<span id="versionPanel"></span></p>
	<div id="testContainer" style="display:none;"></div>
	<div id="out"></div>
</body>
</html>