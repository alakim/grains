<html>
<head>
<title>JSFlow Logging Tests</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251"> 
<script type="text/javascript" src="../../tools/jsUnit.js"></script>
<script type="text/javascript" src="../../html/html.js"></script>
<script type="text/javascript" src="../jsflow.js"></script>
<script type="text/javascript">
function $(id){return document.getElementById(id);}

new JSUnit.Test("Подключение модуля JSFlow", "Configuration").run = function(){
	this.assert(typeof(JSFlow), "object");
}

var log1 = new JSFlow.Log();

function test1(){with(JSFlow){
	var process = new Sequence(
		function(){(new Continuation())()},
		function(){(new Continuation())()},
		function(){(new Continuation())()},
		new Parallel(
			function(){(new Continuation())()},
			function(){(new Continuation())()},
			function(){(new Continuation())()}
		),
		function(){(new Continuation())()},
		function(){(new Continuation())()},
		function(){(new Continuation())()}
	);
	try{
		log1.connect(process);
		
		console.log("run...");
		process.run();
	}
	catch(e){console.log(e);}
	console.log("res!");
	
	var expectations = [
		"Sequence 1 begins",
		"Function 1.0 begins",
		"Function 1.0 ended",
		"Function 1.1 begins",
		"Function 1.1 ended",
		"Function 1.2 begins",
		"Function 1.2 ended",
		"Parallel 1.3 begins",
		"Function 1.3.0 begins",
		"Function 1.3.0 ended",
		"Function 1.3.1 begins",
		"Function 1.3.1 ended",
		"Function 1.3.2 begins",
		"Function 1.3.2 ended",
		"Parallel 1.3 ended",
		//"Sequence 1 ended",
		"Function 1.4 begins",
		"Function 1.4 ended",
		"Function 1.5 begins",
		"Function 1.5 ended",
		"Function 1.6 begins",
		"Function 1.6 ended",
		"Sequence 1 ended"
	];
	
	with(Html){
		$("out").innerHTML = div(
			apply(log1.log, function(msg, i){
				var ok = expectations[i]==msg;
				return div(i+1, ": ", 
					span({style:"color:#"+(ok?"080":"f00")},
						msg,
						ok?null:span(" (Expected '", expectations[i], "')")
					)
				);
			})
		);
	}
}}

function init(){
	$("versionPanel").innerHTML = JSFlow.version;
	JSUnit.init();
	test1();
}
</script>
</head>
<body onload="init()">
	<h1>JSFlow Logging Tests</h1>
	<p>JSFlow v.<span id="versionPanel"></span></p>
	<div id="testContainer" style="display:none;"></div>
	<div id="out"></div>
</body>
</html>