<html>
<head>
<script type="text/javascript" src="../fuzzy.js"></script>
<script type="text/javascript" src="html.js"></script>
<script type="text/javascript">
function extend(m,s){for(var k in s){m[k] = s[k];}}

function each(coll, F){
	if(coll.length)
		for(var i=0; i<coll.length; i++){F(coll[i], i);}
	else
		for(var k in coll){F(coll[k], k);}
}

function max(coll){
	var idx = 0;
	var val = null;
	each(coll, function(v, i){
		if(val==null){
			val = v; idx = i;
		}
		else if(v>val){
			val = v; idx = i;
		}
	});
	
	return {val:val, idx:idx};
}

function filter(coll, cond){
	var res = [];
	NsiBase.each(coll, function(el){if(cond(el))res.push(el);});
	return res;
}

function $(id){
	return document.getElementById(id);
}

function $$(tag, root, condition){
	root = root?root:document;
	var coll = root.getElementsByTagName(tag);
	if(condition!=null){
		if(typeof(condition)=="string")
			condition = new Function("el", "with(el){return "+condition+";}");
		coll = NsiBase.filter(coll, condition);
	}
	return coll;
}

function isIE(){
	return navigator.appName.match(/internet\s+explorer/i);
}

function addEventHandler(element, event, handler){
	if(element.addEventListener)
		element.addEventListener(event, handler, true);
	else
		element.attachEvent("on"+event, handler);
}

function viewObject(obj, htmlMode){
	if(typeof(obj)!="object")
		return obj.toString();
	var s = [];
	for(var k in obj){
		if(typeof(obj[k])!="function")
			s.push((htmlMode?k.bold():k)+": "+NsiBase.viewObject(obj[k], htmlMode)+(htmlMode?"<br>":"\n"));
	}
	return s.join("");
}


var MakeUp = {
	
	rules: {
		extraWide: Fuzzy.functions.S(800, 900),
		wide: Fuzzy.functions.P(700, 800, 100, 100),
		narrow: Fuzzy.functions.Z(350, 450),
		lowHeight: Fuzzy.functions.Z(200, 300),
		
		useNarrow: function(w, h){with(Fuzzy){var _=this;
			return and(_.narrow(w), not(_.lowHeight(h)));
		}},
		
		useNoNews: function(w, h){with(Fuzzy){var _=this;
			return and(not(or(_.wide(w), _.extraWide(w))), not(_.narrow(w)), not(_.lowHeight(h)));
		}},
		
		useStandard: function(w,h){with(Fuzzy){var _=this;
			return and(_.wide(w), not(_.lowHeight(h)));
		}},
		
		useLight: function(w,h){with(Fuzzy){var _=this;
			return and(_.narrow(w), _.lowHeight(h));
		}},
		
		useWide: function(w,h){with(Fuzzy){var _=this;
			return _.extraWide(w);
		}}
	},
	
	blocks:{
		header: function(){with(Html){
			return div(
				h1("Заголовок сайта")
			);
		}},
		
		news: function(){with(Html){
			return div(
				h2("Новости"),
				times(10, function(i){
					return p(i, ": ", "Текст новостного сообщения");
				})
			);
		}},
		
		page: function(colCount){with(Html){
			colCount = colCount?colCount:1;
			var newsCount = 22;
			
			function article(i){
				return div(
					p({style:"margin-bottom:0px;"}, i, ": ",
						times(20, function(i){return "abcdefg ";})
					),
					p({style:"text-align:right; margin-top:0px;"}, a({href:"#"}, "Подробнее..."))
				);
			}
			
			if(colCount==1)
				return div(
					times(newsCount, function(i){
						return article(i);
					})
				);
			else
				return div(table({border:0, cellpadding:3, cellspacing:0}, tr(
					times(colCount, function(i){
						return td({valign:"top"},
							times(newsCount/colCount, function(j){
								return article(j+(newsCount/colCount)*(i-1));
							})
						);
					})
				)));
		}},
		
		menu: function(){with(Html){
			return div(
				h2("Разделы сайта"),
				ul(
					times(6, function(i){
						return li("Раздел ", i);
					})
				)
			)
		}}
	},
	
	makeUps:{
		narrow: function(){with(Html){var _=MakeUp;
			return div(
				_.blocks.header(),
				p(a({href:"#"}, "Новости")),
				_.blocks.menu(),
				_.blocks.page()
			);
		}},
		
		wide: function(){with(Html){
			return table({border:1, width:"100%", cellpadding:3, cellspacing:0}, 
				tr(td({colspan:3, align:"center"}, MakeUp.blocks.header())),
				tr(
					td({valign:"top", width:150}, MakeUp.blocks.menu()),
					td({valign:"top"}, MakeUp.blocks.page(2)),
					td({valign:"top", width:150}, MakeUp.blocks.news())
				)
			);
		}},
		
		standard: function(){with(Html){
			return table({border:1, width:"100%", cellpadding:3, cellspacing:0}, 
				tr(td({colspan:3, align:"center"}, MakeUp.blocks.header())),
				tr(
					td({valign:"top", width:150}, MakeUp.blocks.menu()),
					td({valign:"top"}, MakeUp.blocks.page()),
					td({valign:"top", width:150}, MakeUp.blocks.news())
				)
			);
		}},
		
		noNews: function(){with(Html){
			return table({border:1, width:"100%", cellpadding:3, cellspacing:0}, 
				tr(td({colspan:2, align:"center"}, MakeUp.blocks.header())),
				tr(
					td({valign:"top", width:150},
						p(a({href:"#"}, "Новости")),
						MakeUp.blocks.menu()
					),
					td({valign:"top"}, MakeUp.blocks.page())
				)
			);
		}},
		
		light: function(){with(Html){var _=MakeUp;
			return div(
				_.blocks.header(),
				p(a({href:"#"}, "Оглавление")),
				p(a({href:"#"}, "Новости")),
				_.blocks.page()
			);
		}}
	},
	
	arrange: function(width, height){var _=this;
		var width = window.innerWidth;
		var height = window.innerHeight;
		
		document.body.innerHTML = _.makeUps[max({
			"narrow": _.rules.useNarrow(width, height),
			"noNews": _.rules.useNoNews(width, height),
			"light": _.rules.useLight(width, height), 
			"standard": _.rules.useStandard(width, height),
			"wide": _.rules.useWide(width, height)
		}).idx]();
	}
}

function init(){
	addEventHandler(window, "resize", function(){ MakeUp.arrange(); });
	MakeUp.arrange();
}
</script>
</head>
<body onload="init()">
</body>
</html>