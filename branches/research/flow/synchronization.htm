<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<script type="text/javascript" src="flow.js"></script>
<script type="text/javascript">

function $(id){return document.getElementById(id);}

function log(msg){$("out").innerHTML+=msg+"<br>";}

function f1(){log("f1 called");}
function f2(){log("f2 called");}
function f3(){log("f3 called");}

var TestService = {
	GetSum: function(x, y, onload){
		var res = x+y;
		setTimeout(function(){
			onload(res);
		}, 2000);
	}
};

function init(){with(Flow){

	new Sequence([
		function(){f1(); setTimeout(new Continuation(), 1000);},
		function(){
			f2();
			setTimeout(function(){
				(new Continuation())();
			}, 500);
		},
		function(){
			log("TestService GetSum requested...");
			TestService.GetSum(3, 2, function(res){
				log("TestService GetSum result: "+res);
				(new Continuation())()
			});
		},
		function(){f3(); setTimeout(new Continuation(), 300);},
		
		function(){log("End of sequence reached")}
	]).run();

}}	
</script>
</head>
<body onload="init()">
	<h1>Flow sample</h1>
	<div id="out"></div>
</body>
</html>