<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>XEdit Demo Page</title>
	<link rel="stylesheet" type="text/css" href="xedit.css"/>
	<script type="text/javascript" src="../coollab/lib/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="../coollab/lib/html.js"></script>
	<script type="text/javascript" src="xedit.js"></script>
	<script type="text/javascript">
		var docSpec = {
			onchange: function(){
				console.log("I been changed now!")
			},
			validate: function(obj){
				console.log("I be validatin' now!")
			},
			elements: {
				"library": {
					displayName: "en: library | ru: библиотека",
					menu: [{
						caption: "ru: Добавить книгу | en: Add new <book>",
						action: XEdit.newElementChild,
						actionParameter: "<book/>"
					}]
				},
				"book": {
					displayName: "en: book | ru: книга",
					menu: [
						{
							caption: "Добавить заголовок @title=\"***\"",
							action: XEdit.newAttribute,
							actionParameter: {name: "title", value: "***"},
							hideIf: function(jsElement){
								return jsElement.hasAttribute("title");
							}
						},
						{
							caption: "Добавить аннотацию <annotation>",
							action: XEdit.newElementChild,
							actionParameter: "<annotation>***</annotation>",
							hideIf: function(jsElement){
								return jsElement.hasChildElement("annotation");
							}
						},
						{
							caption: "Добавить жанр @genre=\"\"",
							action: XEdit.newAttribute,
							actionParameter: {name: "genre", value: ""},
							hideIf: function(jsElement){
								return jsElement.hasAttribute("genre");
							}
						},
						{
							caption: "Удалить эту книгу <book>",
							action: XEdit.deleteElement
						}, 
						{
							caption: "Вставить книгу <book> перед этой",
							action: XEdit.newElementBefore,
							actionParameter: "<book/>"
						},
						{
							caption: "Вставить книгу <book> после этой",
							action: XEdit.newElementAfter,
							actionParameter: "<book/>"
						}
					],
					canDropTo: ["library"],
					attributes: {
						"title": {
							asker: XEdit.askString,
							menu: [{
								caption: "Удалить этот заголовок @title",
								action: XEdit.deleteAttribute
							}]
						},
						genre:{
							asker: XEdit.askPicklist,
							askerParameter: [
								{value: "novel", caption: "роман"},
								{value: "story", caption: "повесть"}
							]
						}
					}
				},
				annotation:{
					menu: [
						{
							caption: "Удалить эту аннотацию <annotation>",
							action: XEdit.deleteElement
						},
						{
							caption: "Добавить абзац <p>",
							action: XEdit.newElementChild,
							actionParameter: "<p>***</p>"
						}
					],
					canDropTo: ["book"],
					collapsed: function(el){return !el.hasChildElement("p");}
				},
				p:{
					menu: [
						{
							caption: "Удалить этот абзац <p>",
							action: XEdit.deleteElement
						}, 
						{
							caption: "Вставить абзац <p> перед этим",
							action: XEdit.newElementBefore,
							actionParameter: "<p/>"
						},
						{
							caption: "Вставить абзац <p> после этого",
							action: XEdit.newElementAfter,
							actionParameter: "<p/>"
						}
					],
					canDropTo: ["annotation"],
					asker: XEdit.askLongString,
					collapsed: true
				}
			}
		};
		
		var xml = "<library><book title='Война и мир'/><book title='Капитанская дочка'/></library>";
		
		function start(){
			XEdit.lang = "en";
			XEdit.render(xml, $("#editor")[0], docSpec);
		}
		function submit(){
			console.log(XEdit.harvest());
		}
		function setMode(m){
			XEdit.setMode(m);
		}
		function setLang(lang){
			XEdit.lang = lang;
			var content = XEdit.harvest();
			XEdit.render(content, $("#editor")[0], docSpec);
			//XEdit.refresh();
		}
		$(start);
	</script>
</head>
<body>
	<h1>XEdit Demo Page</h1>
	<div>
		<input type="button" onclick="submit()" value="Harvest"/>
		<input type="button" onclick="setMode('nerd')" value="Nerd Mode"/>
		<input type="button" onclick="setMode('laic')" value="Laic Mode"/>
		
		<input type="button" onclick="setLang('en')" value="EN"/>
		<input type="button" onclick="setLang('ru')" value="RU"/>
		
	</div>
	<div id="editor"></div>
</body>
</html>